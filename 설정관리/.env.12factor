# .env.12factor - Project Odysseus 12-Factor App 환경 변수
# 모든 설정을 환경 변수로 관리하여 컨테이너/쿠버네티스 환경에 최적화

# =============================================================================
# 🚀 프로젝트 기본 설정
# =============================================================================

PROJECT_NAME=Project Odysseus
VERSION=1.0.0
ENVIRONMENT=development
TRADING_MODE=testnet
DRY_RUN=true
INITIAL_CAPITAL=1000.0

# =============================================================================
# 🗄️ 데이터베이스 설정 (TimescaleDB)
# =============================================================================

# 기본 연결 설정
DB__HOST=localhost
DB__PORT=5432
DB__DATABASE=odysseus_trading
DB__USER=postgres
DB__PASSWORD=your_secure_password_here

# 테이블 이름 설정
DB__TABLE_PRICE_DATA=price_data
DB__TABLE_ORDERBOOK_DATA=orderbook_data
DB__TABLE_PAIR_ANALYSIS=pair_analysis
DB__TABLE_SIGNALS=signals
DB__TABLE_TRADES=trades
DB__TABLE_POSITIONS=positions

# PostgreSQL 성능 튜닝
POSTGRES_MAX_CONNECTIONS=200
POSTGRES_SHARED_BUFFERS=256MB
POSTGRES_WORK_MEM=4MB
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB

# =============================================================================
# 🏦 거래소 API 설정
# =============================================================================

# Binance 설정
EXCHANGES__BINANCE_API_KEY=your_binance_api_key_here
EXCHANGES__BINANCE_SECRET_KEY=your_binance_secret_key_here

# Bybit 설정
EXCHANGES__BYBIT_API_KEY=your_bybit_api_key_here
EXCHANGES__BYBIT_SECRET_KEY=your_bybit_secret_key_here

# 거래소 공통 설정
EXCHANGES__PRIMARY_EXCHANGE=binance
EXCHANGES__MARKET_TYPE=spot
EXCHANGES__SPOT_MAKER_FEE=0.001
EXCHANGES__SPOT_TAKER_FEE=0.001
EXCHANGES__FUTURES_MAKER_FEE=0.0002
EXCHANGES__FUTURES_TAKER_FEE=0.0005

# =============================================================================
# 📊 데이터 수집 설정
# =============================================================================

DATA_COLLECTION__VALIDATION_POLICY=interpolate
DATA_COLLECTION__HISTORICAL_DATA_START=2022-01-01
DATA_COLLECTION__DEFAULT_TIMEFRAME=1h
DATA_COLLECTION__REALTIME_DATA_INTERVAL=5
DATA_COLLECTION__WEBSOCKET_TIMEOUT=30
DATA_COLLECTION__MAX_PRICE_DEVIATION=0.1
DATA_COLLECTION__MAX_MISSING_DATA_RATIO=0.05

# =============================================================================
# 🔍 페어 탐색 설정
# =============================================================================

PAIR_SEARCH__RE_SEARCH_SCHEDULE=weekly
PAIR_SEARCH__TOP_N_ASSETS_FOR_UNIVERSE=50
PAIR_SEARCH__MIN_MARKET_CAP_RANK=100
PAIR_SEARCH__MIN_DAILY_VOLUME_USD=10000000
PAIR_SEARCH__EXCLUDE_STABLECOINS=true
PAIR_SEARCH__K_MEANS_N_CLUSTERS=5
PAIR_SEARCH__COINTEGRATION_P_VALUE_THRESHOLD=0.05
PAIR_SEARCH__COINTEGRATION_LOOKBACK_DAYS=252
PAIR_SEARCH__MIN_CORRELATION=0.7
PAIR_SEARCH__MAX_CORRELATION=0.95

# =============================================================================
# 🎛️ 칼만 필터 설정
# =============================================================================

KALMAN_FILTER__TRANSITION_COVARIANCE=0.01
KALMAN_FILTER__OBSERVATION_COVARIANCE=0.1
KALMAN_FILTER__INITIAL_STATE_COVARIANCE=1.0
KALMAN_FILTER__LOOKBACK_PERIOD=100
KALMAN_FILTER__UPDATE_FREQUENCY=1h

# =============================================================================
# 📈 시장 국면 필터 설정
# =============================================================================

MARKET_REGIME__REPRESENTATIVE_ASSET=BTC/USDT

# 추세 필터
MARKET_REGIME__TREND_FILTER__EMA_PERIOD=200
MARKET_REGIME__TREND_FILTER__EMA_SHORT_PERIOD=50
MARKET_REGIME__TREND_FILTER__TREND_STRENGTH_THRESHOLD=0.02

# 변동성 필터
MARKET_REGIME__VOLATILITY_FILTER__GARCH_P=1
MARKET_REGIME__VOLATILITY_FILTER__GARCH_Q=1
MARKET_REGIME__VOLATILITY_FILTER__LOOKBACK_DAYS=90
MARKET_REGIME__VOLATILITY_FILTER__THRESHOLD_PERCENTILE=80
MARKET_REGIME__VOLATILITY_FILTER__MIN_VOLATILITY=0.01
MARKET_REGIME__VOLATILITY_FILTER__MAX_VOLATILITY=0.15

# 거래량 필터
MARKET_REGIME__VOLUME_FILTER__LOOKBACK_PERIOD=30
MARKET_REGIME__VOLUME_FILTER__MIN_VOLUME_RATIO=0.5

# =============================================================================
# 🎯 신호 생성 설정
# =============================================================================

SIGNAL_GENERATION__Z_SCORE_ENTRY_THRESHOLD=2.0
SIGNAL_GENERATION__Z_SCORE_EXIT_THRESHOLD=0.5
SIGNAL_GENERATION__Z_SCORE_STOP_LOSS_THRESHOLD=3.5
SIGNAL_GENERATION__ML_MODEL_PROBABILITY_THRESHOLD=0.75
SIGNAL_GENERATION__MIN_SIGNAL_GAP_HOURS=4
SIGNAL_GENERATION__SIGNAL_DECAY_HOURS=24
SIGNAL_GENERATION__REQUIRE_ALL_FILTERS=true

# =============================================================================
# 🤖 머신러닝 모델 설정
# =============================================================================

ML_MODEL__MODEL_TYPE=xgboost
ML_MODEL__MODEL_PATH=./ml_models/models/
ML_MODEL__RETRAIN_FREQUENCY=monthly
ML_MODEL__MIN_TRAINING_SAMPLES=1000
ML_MODEL__VALIDATION_SPLIT=0.2

# XGBoost 하이퍼파라미터
ML_MODEL__N_ESTIMATORS=100
ML_MODEL__MAX_DEPTH=6
ML_MODEL__LEARNING_RATE=0.1
ML_MODEL__RANDOM_STATE=42

# =============================================================================
# ⚠️ 리스크 관리 설정
# =============================================================================

# 손절매 설정
RISK_MANAGEMENT__STOP_LOSS__Z_SCORE_THRESHOLD=3.5
RISK_MANAGEMENT__STOP_LOSS__TIME_LIMIT_HOURS=240
RISK_MANAGEMENT__STOP_LOSS__DRAWDOWN_THRESHOLD=0.05

# 포지션 제한
RISK_MANAGEMENT__POSITION_LIMITS__MAX_PAIRS_SIMULTANEOUS=5
RISK_MANAGEMENT__POSITION_LIMITS__CORRELATION_LIMIT=0.8

# 일일 제한
RISK_MANAGEMENT__DAILY_LIMITS__MAX_DAILY_TRADES=20
RISK_MANAGEMENT__DAILY_LIMITS__MAX_DAILY_LOSS=0.02
RISK_MANAGEMENT__DAILY_LIMITS__COOLING_PERIOD_HOURS=1

# =============================================================================
# 💰 포지션 사이징 설정
# =============================================================================

POSITION_SIZING__METHOD=linear
POSITION_SIZING__MAX_POSITION_PER_PAIR=0.1
POSITION_SIZING__MAX_TOTAL_EXPOSURE=0.5
POSITION_SIZING__MIN_POSITION_SIZE_USD=20
POSITION_SIZING__MAX_POSITION_SIZE_USD=100
POSITION_SIZING__LEVERAGE=1.0

# =============================================================================
# 📋 주문 실행 설정
# =============================================================================

ORDER_EXECUTION__ORDER_TYPE=limit
ORDER_EXECUTION__SLIPPAGE_PROTECTION=true
ORDER_EXECUTION__MAX_SLIPPAGE_BPS=10
ORDER_EXECUTION__ORDER_TIMEOUT_SECONDS=60
ORDER_EXECUTION__PARTIAL_FILL_THRESHOLD=0.8
ORDER_EXECUTION__RETRY_ATTEMPTS=3
ORDER_EXECUTION__TWAP_INTERVALS=5

# =============================================================================
# 📝 모니터링 및 로깅 설정
# =============================================================================

# 로깅 설정
MONITORING__LOGGING__LEVEL=INFO
MONITORING__LOGGING__LOG_TO_FILE=true
MONITORING__LOGGING__LOG_FILE_PATH=./logs/
MONITORING__LOGGING__MAX_FILE_SIZE_MB=100
MONITORING__LOGGING__BACKUP_COUNT=5
MONITORING__LOGGING__SEPARATE_ERROR_LOG=true
MONITORING__LOGGING__PERFORMANCE_LOG=true

# 텔레그램 알림
MONITORING__TELEGRAM__ENABLED=true
MONITORING__TELEGRAM__BOT_TOKEN=your_telegram_bot_token_here
MONITORING__TELEGRAM__CHAT_ID=your_telegram_chat_id_here
MONITORING__TELEGRAM__RATE_LIMIT_MINUTES=5
MONITORING__TELEGRAM__MAX_MESSAGE_LENGTH=4000
MONITORING__TELEGRAM__NOTIFY_ON_TRADE=true
MONITORING__TELEGRAM__NOTIFY_ON_ERROR=true
MONITORING__TELEGRAM__NOTIFY_ON_DAILY_SUMMARY=true

# 성과 추적
MONITORING__PERFORMANCE_UPDATE_INTERVAL_MINUTES=15
MONITORING__DAILY_SUMMARY_TIME=09:00
MONITORING__WEEKLY_REPORT_DAY=monday

# =============================================================================
# 🌐 대시보드 설정
# =============================================================================

DASHBOARD__ENABLED=true
DASHBOARD__HOST=0.0.0.0
DASHBOARD__PORT=8000
DASHBOARD__REFRESH_INTERVAL_SECONDS=30
DASHBOARD__AUTH_REQUIRED=false

# =============================================================================
# 🧪 백테스팅 설정
# =============================================================================

BACKTESTING__START_DATE=2023-01-01
BACKTESTING__END_DATE=2024-12-31
BACKTESTING__BENCHMARK=BTC/USDT
BACKTESTING__SLIPPAGE_MODEL=linear
BACKTESTING__SLIPPAGE_BPS=5
BACKTESTING__REBALANCE_FREQUENCY=daily

# =============================================================================
# ⏰ 스케줄러 설정
# =============================================================================

SCHEDULER__TIMEZONE=UTC
SCHEDULER__MAX_INSTANCES=1
SCHEDULER__MISFIRE_GRACE_TIME=300

# =============================================================================
# 🌐 Nginx 및 리버스 프록시 설정
# =============================================================================

# 도메인 설정
NGINX_HOST=odysseus.local
NGINX_PORT=80

# SSL 설정 (프로덕션용)
SSL_ENABLED=false
SSL_CERT_PATH=/etc/nginx/certs/fullchain.pem
SSL_KEY_PATH=/etc/nginx/certs/privkey.pem

# 보안 설정
NGINX_RATE_LIMIT_API=10r/s
NGINX_RATE_LIMIT_DASHBOARD=5r/s
NGINX_CLIENT_MAX_BODY_SIZE=100M

# =============================================================================
# 📊 모니터링 서비스 설정
# =============================================================================

# Grafana
GRAFANA_PASSWORD=odysseus123
GRAFANA_DOMAIN=grafana.odysseus.local
GRAFANA_ROOT_URL=http://grafana.odysseus.local

# Prometheus
PROMETHEUS_RETENTION=30d
PROMETHEUS_STORAGE_PATH=/prometheus

# Redis Commander
REDIS_COMMANDER_USER=admin
REDIS_COMMANDER_PASSWORD=odysseus123

# PgAdmin (선택적)
PGADMIN_EMAIL=admin@odysseus.local
PGADMIN_PASSWORD=odysseus123

# =============================================================================
# 📓 Jupyter 설정
# =============================================================================

JUPYTER_TOKEN=
JUPYTER_PASSWORD=
JUPYTER_ENABLE_LAB=yes

# =============================================================================
# 🔒 보안 설정
# =============================================================================

# JWT 시크릿 (API 인증용)
JWT_SECRET_KEY=your_jwt_secret_32_characters_minimum

# 암호화 키 (민감 데이터용)
ENCRYPTION_KEY=your_32_byte_encryption_key_here

# 관리자 계정
ADMIN_USERNAME=admin
ADMIN_PASSWORD=odysseus_admin_2024

# =============================================================================
# 🔄 백업 및 복구 설정
# =============================================================================

# 백업 스케줄
BACKUP_SCHEDULE=0 2 * * *
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=
BACKUP_ENCRYPTION_ENABLED=true

# =============================================================================
# ☁️ 클라우드 설정 (선택적)
# =============================================================================

# AWS
AWS_ACCESS_KEY_ID=your_aws_access_key
AWS_SECRET_ACCESS_KEY=your_aws_secret_key
AWS_REGION=us-east-1
S3_BUCKET_NAME=odysseus-trading-data

# Redis Cloud (대안)
REDIS_CLOUD_URL=redis://localhost:6379
REDIS_MAX_MEMORY=256mb

# =============================================================================
# 📡 외부 API 설정 (선택적)
# =============================================================================

# 시장 데이터
COINGECKO_API_KEY=your_coingecko_api_key
COINMARKETCAP_API_KEY=your_cmc_api_key
ALPHA_VANTAGE_API_KEY=your_alphavantage_key

# 경제 데이터
FRED_API_KEY=your_fred_api_key
QUANDL_API_KEY=your_quandl_api_key

# =============================================================================
# 🐳 Docker 및 컨테이너 설정
# =============================================================================

# Docker Compose 프로젝트
COMPOSE_PROJECT_NAME=odysseus
COMPOSE_FILE=docker-compose-enhanced.yml

# 컨테이너 리소스 제한
TRADING_BOT_MEMORY=1G
TRADING_BOT_CPU=1.0
TIMESCALEDB_MEMORY=2G
TIMESCALEDB_CPU=2.0

# =============================================================================
# 🔍 개발 및 디버깅 설정
# =============================================================================

# 개발 모드
DEVELOPMENT_MODE=false
DEBUG_MODE=false
PROFILING_ENABLED=false

# 로그 레벨 (환경별)
LOG_LEVEL=INFO
# 개발: DEBUG, 테스트: INFO, 운영: WARNING

# 테스트 설정
TEST_DB_NAME=odysseus_test
PYTEST_TIMEOUT=300
COVERAGE_THRESHOLD=80

# =============================================================================
# 🌍 지역화 및 시간대 설정
# =============================================================================

# 시간대
TZ=UTC
TIMEZONE=UTC

# 지역 설정
LOCALE=en_US.UTF-8
CURRENCY_DISPLAY=USD

# 거래 시간 설정
TRADING_HOURS_START=00:00
TRADING_HOURS_END=23:59
TRADING_DAYS=mon,tue,wed,thu,fri,sat,sun

# =============================================================================
# ⚡ 성능 최적화 설정
# =============================================================================

# Python 성능
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=1
PYTHONHASHSEED=0

# NumPy/Pandas 최적화
OMP_NUM_THREADS=4
NUMBA_NUM_THREADS=4
OPENBLAS_NUM_THREADS=4

# 메모리 설정
MALLOC_ARENA_MAX=4
MALLOC_MMAP_THRESHOLD=131072

# =============================================================================
# 📊 메트릭 및 추적 설정
# =============================================================================

# 메트릭 수집
METRICS_ENABLED=true
METRICS_INTERVAL=60
METRICS_RETENTION_DAYS=90

# 성과 추적
PERFORMANCE_TRACKING_ENABLED=true
DAILY_REPORT_ENABLED=true
WEEKLY_REPORT_ENABLED=true

# =============================================================================
# 🚨 알림 및 경고 설정
# =============================================================================

# 임계값 알림
ALERT_DAILY_LOSS_THRESHOLD=0.05
ALERT_SYSTEM_CPU_THRESHOLD=80
ALERT_SYSTEM_MEMORY_THRESHOLD=85
ALERT_DISK_USAGE_THRESHOLD=90

# 알림 채널
TELEGRAM_ENABLED=true
EMAIL_ENABLED=false
SLACK_ENABLED=false
WEBHOOK_ENABLED=false

# =============================================================================
# 🔐 보안 강화 설정
# =============================================================================

# 네트워크 보안
ALLOWED_IPS=127.0.0.1,172.20.0.0/16
API_RATE_LIMIT=100/hour
DASHBOARD_RATE_LIMIT=1000/hour

# 세션 관리
SESSION_TIMEOUT_MINUTES=30
SESSION_ENCRYPTION=true

# CORS 설정
CORS_ALLOWED_ORIGINS=http://localhost,http://odysseus.local
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE
CORS_ALLOWED_HEADERS=Content-Type,Authorization

# =============================================================================
# 📋 환경별 설정 오버라이드
# =============================================================================

# 개발 환경 (ENVIRONMENT=development)
# LOG_LEVEL=DEBUG
# DRY_RUN=true
# TRADING_MODE=testnet
# SSL_ENABLED=false

# 테스트 환경 (ENVIRONMENT=testing)  
# LOG_LEVEL=INFO
# DRY_RUN=true
# TRADING_MODE=testnet
# DB__DATABASE=odysseus_test

# 운영 환경 (ENVIRONMENT=production)
# LOG_LEVEL=WARNING
# DRY_RUN=false
# TRADING_MODE=live
# SSL_ENABLED=true
# API_RATE_LIMIT=500/hour

# =============================================================================
# 🎛️ 피처 플래그 (Feature Flags)
# =============================================================================

# 실험적 기능들
FEATURE_ADVANCED_ML=false
FEATURE_MULTI_EXCHANGE=false
FEATURE_FUTURES_TRADING=false
FEATURE_AUTOMATED_REBALANCING=false
FEATURE_SOCIAL_SENTIMENT=false

# 베타 기능들
BETA_NEW_SIGNAL_ALGORITHM=false
BETA_DYNAMIC_POSITION_SIZING=false
BETA_CROSS_ASSET_ANALYSIS=false

# =============================================================================
# 📈 비즈니스 로직 설정
# =============================================================================

# 거래 전략
STRATEGY_MIN_PROFIT_TARGET=0.02
STRATEGY_MAX_HOLDING_DAYS=30
STRATEGY_REBALANCE_THRESHOLD=0.05

# 시장 조건
MARKET_MIN_LIQUIDITY=1000000
MARKET_MAX_SPREAD_BPS=20
MARKET_MIN_TRADING_HOURS=20

# =============================================================================
# 🔧 운영 및 유지보수 설정
# =============================================================================

# 자동 업데이트
AUTO_UPDATE_ENABLED=false
UPDATE_CHECK_INTERVAL=daily
MAINTENANCE_WINDOW=02:00-04:00

# 모니터링 주기
HEALTH_CHECK_INTERVAL=30s
RESOURCE_CHECK_INTERVAL=5m
PERFORMANCE_REPORT_INTERVAL=1h

# =============================================================================
# 💡 사용 가이드
# =============================================================================

# 1. 이 파일을 .env로 복사:
#    cp .env.12factor .env

# 2. 필수 값들 수정:
#    - DB__PASSWORD
#    - EXCHANGES__*_API_KEY, EXCHANGES__*_SECRET_KEY  
#    - MONITORING__TELEGRAM__BOT_TOKEN, MONITORING__TELEGRAM__CHAT_ID

# 3. 환경별 설정:
#    개발: ENVIRONMENT=development, TRADING_MODE=testnet
#    운영: ENVIRONMENT=production, TRADING_MODE=live

# 4. Docker 실행:
#    docker-compose -f docker-compose-enhanced.yml up -d

# 5. 도메인 설정:
#    ./setup_domains.sh setup

# 6. 브라우저 접속:
#    http://odysseus.local

# =============================================================================
# ⚡ 빠른 설정 템플릿
# =============================================================================

# 개발 환경 빠른 설정:
# ENVIRONMENT=development
# TRADING_MODE=testnet  
# DRY_RUN=true
# LOG_LEVEL=DEBUG
# DB__PASSWORD=dev123
# EXCHANGES__BINANCE_API_KEY=testnet_key
# MONITORING__TELEGRAM__BOT_TOKEN=dev_bot_token

# 운영 환경 빠른 설정:
# ENVIRONMENT=production
# TRADING_MODE=live
# DRY_RUN=false  
# LOG_LEVEL=WARNING
# SSL_ENABLED=true
# [실제 API 키들 설정]